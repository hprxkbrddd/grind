# Порты для микросервисов

каждый микросервис должен крутиться на указанном порту

- **gateway** - 8080
- **security** - built-in
- **database** - 8082
- **core** - 8083
- **statistics** - 8084

# Docker compose

Для каждого микросервиса должен быть написан `Dockerfile` для сборки образа самого микросервиса. По готовности всех микросервисов напишем общий `docker-compose.yml` для сборки всех образов разом.<br>
**Перед сборкой образа замените конфигурацию подключения к бд.** <br>
В пропертях укажите не константу, а имя внешней переменной и через нее передайте конфигурацию в `Dockerfile` (актуально только для этапа сборки образа)

# Команда для стягивания образа бд с заданием нужных параметров контейнера через докер 

```bash
docker run -d --name grind-db -e POSTGRES_DB=grind -e POSTGRES_USER=grind -e POSTGRES_PASSWORD=grind -p 5432:5432 postgres:17
```

- **адрес бд** - `localhost:5432/grind`
- **имя пользователя** - `grind`
- **пароль** - `grind`
- **название контейнера** - `grind-db`

# Security library

Библиотека автоконфигурации, создающая бины Spring Security защиты от
несанкционированного доступа к данным. Также содержит эндпоинты для выдачи
и проверки JWT токена.

## Получение токена
- Эндпоинт
  - `/grind/keycloak/token`
- Поля тела запроса JSON
  - `username`
  - `password`
- Поля ответа JSON
  - `access_token` - сам JWT
  - `expires_in` - когда истекает 
  - `refresh_expires_in`
  - `refresh_token`
  - `id_token`
  - `not-before-policy`
  - `session_state`

## Проверка токена
- Эндпоинт
  - `/grind/keycloak/instrospect`
- Поля тела запроса
  - заголовок `Authorization` с токеном
- Поля тела ответа JSON
  - `active` - активен ли токен
  - `sub` - id владельца
  - `username` - имя владельца
  - `exp` - момент истечения токена
  - `iat` - момент запроса токена
  - `email`
  - `scope`
  - `token-type`
  - `client-id`

## Регистрация
- Эндпоинт
  - `/grind/keycloak/register`
- Поля тела запроса JSON
  - `username`
  - `password`
  - `email`
  - `firstName`
  - `lastName`
  - `isEnabled`

# Поднятие Kafka через Docker

Для поднятия контейнера 
1. перейти в корень проекта
2. выполнить в терминале команду (или запустить `compose.yaml` другим способом)

```bash
docker compose up -d
# для запуска с логами в терминале убрать флаг -d
```

Поднимется 2 контейнера
- **Kafka** - сам брокер (базовый образ) `localhost:9092`
- **Kafdrop** - UI для взаимодействия с брокером (просмотр сообщений, топиков партиций) `localhost:9000`

Есть образ Kafka от Confluent с предустановленной UI, 
но он тянет много фич, которые в проекте не будут использоваться, 
но сожрут место на диске
